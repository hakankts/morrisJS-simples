<?php 
	require_once(dirname($_SERVER['DOCUMENT_ROOT']) . "/cgi-bin/functions.php");
	require_once(dirname($_SERVER['DOCUMENT_ROOT']) . "/root/yeni_ekran/dashboard_repostory/kullaniciKontrolClass.php");
	
	class chartClassTedarikOdeme extends kullaniciKontrolClass{

		protected $cdb;
		protected $hasarTable;					
		protected $companyId;			
		protected $kullaniciKriter;	
		protected $otodisiKullaniciKriter;
		protected $OTODISI_DOSYA_SORUMLUSU;
		protected $DEF_DOSYA_SORUMLUSU;
		function __construct()
		{
			global $SESSION;
			require_valid_login();
			$this->cdb 				= new db_layer;			
			$this->hasarTable   	= get_hasar_table();									
			$this->companyId 		= OAConf::COMPANY_ID;						
			$this->USER_NAME		= $SESSION['username'];  			
			$this->USER_ID			= $SESSION['user_id'];  						
			$this->kullaniciKontrol();				
						
		}


        function chartBlok($brans,$tarih1,$tarih2,$marka_id,$kullanim_sekli,$tedarikci,$sehir_id,$eksper,$rapor_secim,$siparis_uygun,$eksperli,$filo_haric,$filo_acenteler,$arac_yasi,$police_kodu){ 
			
			if( ($this->kullaniciKontrol() == '2' || $this->hdsKullaniciKriter) ) { return false;}
						
			if($brans!=NULL && $brans!=-1){ 
				$kriter .=  " AND H.SIGORTA_SEKLI='$brans'";
			}
						
			if(($tarih1 && $tarih2)){				
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			} else {					
				$tarih1 = date("Y-m-d", mktime(0, 0, 0, date("01") , date("01"), date("Y")));
				$tarih2 = date("Y-m-d", mktime(0, 0, 0, date("m") , date("d"), date("Y")));	
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			}
			
			if($arac_yasi){
				if($arac_yasi>9){ 
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) > 9 "; 
				} else {
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) IN ($arac_yasi) ";
				}
			}
			
			if($police_kodu){
				$kriter .= " AND H.POLICE_NO IN ($police_kodu)";
			}

			if ($filo_haric == 1){
				$acente_arr = explode(",",$filo_acenteler);
				$acente_str = implode("','",$acente_arr);
				$kriter .= " AND H.SB_ACENTE_KODU NOT IN ('".$acente_str."')";
			}			
			
			if(($kullanim_sekli!=NULL && $kullanim_sekli!='-1')){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.SB_ARAC_KULLANIM_TURU , H.SB_ARAC_KULLANIM_TURU)='$kullanim_sekli'";
			}			
			
			if(($tedarikci!=NULL &&  $tedarikci!='-1')){ 
				$kriter .=  " AND S.TEDARIKCI_ID='$tedarikci'";
			}

			if(($sehir_id!=NULL &&  $sehir_id!='-1')){ 
				$kriter .=  " AND H.HASAR_ILI='$sehir_id'";
			}

			if(($eksper!=NULL &&  $eksper!='-1')){ 
				$kriter .=  " AND H.USER_EKSPER='$eksper'";
			}

			if($marka_id!=NULL && $marka_id!='-1'){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.MARKA_ID , H.HAS_MARKA_ID)='$marka_id'";
			}			
			if($siparis_uygun==1)	{
				$kriter .=  " AND H.SIPARIS_UYGUN = '1'";			
			}
			if($eksperli==1)	{
				$kriter .=  " AND IFNULL(H.SERVIS_DOSYA, 0) = 0";			
			}
				
			$sql = "
			SELECT									
								GROUP_CONCAT(DISTINCT H.ID) AS DOSYA_NOLAR,
								U.NAME AS EKSPER,																
								IF(H.SIGORTA_SEKLI=1, HMA.MODEL_YILI,H.HAS_MODEL_YILI) AS MODEL_YILI,
								COUNT(DISTINCT H.ID) AS TOPLAM_DOSYA_SAYISI,
								TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, HD.ADET, HD.ADET ) ) ,2) AS TOPLAM_ADET,
								TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) 
											WHEN HD.ISLEM=3 THEN HD.BIRIM_FIYAT_GERCEK
										END  
									),2) AS ISCILIK_SISTEM,	
								TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS ISCILIK_GERCEK,
								TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL(HD.SIPARIS_SECENEK, 0) = 1,HD.BIRIM_FIYAT_SISTEM * HD.ADET,0))											
											+ SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0) = 1, HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) )
											+ SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) )
											+ SUM( IF ( ( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0 ) OR ( HD.SIPARIS_SECENEK = 1 AND SD. STATUS = 2 ), HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 )) 
											+ SUM( IF ( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) > 0, HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 )) 
											+ SUM( IF ( ( IFNULL( HD.SIPARIS_SECENEK, 0 ) NOT IN (1, 2) OR ( IFNULL(SD.ID, 0) = 0 AND IFNULL( HD.SIPARIS_SECENEK,0) = 1) OR (IFNULL(SD.ID, 0) > 0 AND IFNULL(SD. STATUS, 0) <> 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 ) ), IF ( HD.VERITABANINDA = 1, HD.BIRIM_FIYAT_SISTEM, HD.BIRIM_FIYAT_GERCEK ) * HD.ADET, 0 )) ,2) 
								AS TOPLAM_SISTEM_TUTAR,
								TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ) * HD.ADET, 0 ) ) 
											+ SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ) * HD.ADET, 0 ) ) 
											+ SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ) * HD.ADET, 0 ) ) 
											+ SUM( IF (( HD.SIPARIS_SECENEK = 2) OR (HD.SIPARIS_SECENEK=1 AND SD.STATUS=2), IF ( IFNULL(HD.YS_ISKONTO, 0) = 0, ( IF ( HD.VERITABANINDA, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ), 0 ) + HD.BIRIM_FIYAT_GERCEK * IFNULL( HD.KHHH_ISKONTO, 0 ) / 100 ) * HD.ADET, 0 ), 0 ) ) 
											+ SUM( IF ( HD.SIPARIS_SECENEK = 2, IF ( IFNULL(HD.YS_ISKONTO, 0) > 0, ( IF ( HD.VERITABANINDA, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ), 0 ) + HD.BIRIM_FIYAT_GERCEK * IFNULL( HD.KHHH_ISKONTO, 0 ) / 100 ) * HD.ADET, 0 ), 0 ) ) 
											+ SUM( IF ( ( IFNULL( HD.SIPARIS_SECENEK, 0 ) NOT IN (1, 2) OR ( IFNULL(SD.ID, 0) = 0 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 ) OR ( IFNULL(SD.ID, 0) > 0 AND IFNULL(SD. STATUS, 0) <> 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 ) ), ( IF ( HD.VERITABANINDA = 1, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK ) + HD.BIRIM_FIYAT_GERCEK * IFNULL( HD.KHHH_ISKONTO, 0 ) / 100, HD.BIRIM_FIYAT_GERCEK * IFNULL( HD.KHHH_ISKONTO, 0 ) / 100 ) ) * HD.ADET, 0 ) ) 												
								,2) AS TOPLAM_GERCEKLESEN,	
								
								
								TRUNCATE(
									SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL( SD.LO, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 , HD.ADET, 0 ) )
									,0) AS TOPLAM_ORJ_ADET,
								
								TRUNCATE(
								SUM( IF (  (SD.ESDEGER_OLABILIR_SEBEP=2) OR  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) IN (0,1)  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1  OR (SD.ESDEGER_OLABILIR_SEBEP>0) OR ( IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)),  HD.ADET,  0  )  )
								,0) AS TOPLAM_LOESD_ADET,
								
								TRUNCATE(
								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1  , HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) )
								,2) AS TOPLAM_ORJ_SISTEM_TUTAR,
								TRUNCATE(
								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1  , HD.BIRIM_FIYAT_GERCEK * HD.ADET, 0 ))
								,2) AS TOPLAM_ORJ_GERCEKLESEN,
								
								TRUNCATE(
									SUM(  IF (  (SD.ESDEGER_OLABILIR_SEBEP=2) OR  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) IN (0,1)  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1  OR (SD.ESDEGER_OLABILIR_SEBEP>0) OR ( IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  )
								,2) AS TOPLAM_LOESD_SISTEM_TUTAR,
								 TRUNCATE(
								 SUM(    IF (  (SD.ESDEGER_OLABILIR_SEBEP=2) OR IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) IN (0,1)  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1  OR (SD.ESDEGER_OLABILIR_SEBEP>0) OR ( IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)),  HD.BIRIM_FIYAT_GERCEK * HD.ADET,  0  )  )
								 ,2) AS TOPLAM_LOESD_GERCEKLESEN,

								/* YETKILI TÜMÜ */	
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=1, H.ID, NULL)) AS YET_TUMU_DOSYALAR,		
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1, H.ID, NULL)) AS YET_TUMU_DOSYA_ADET,										
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.ADET
									END 
								),0) AS YET_TUMU_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.SOKTAK,0) + IFNULL(HD.BOYA_TUTAR,0) + IFNULL(HD.TAMIR,0))>0) THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN HD.ADET
									END 
								),0) AS YET_TUMU_ONARIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS YET_TUMU_SISTEM,
								TRUNCATE(SUM( 
									CASE 									
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1  AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS YET_TUMU_GERCEKLESEN,																	
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) 
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS YET_TUMU_SISTEM_ISCILIK,	
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS YET_TUMU_GERCEK_ISCILIK,	

								/* END */	
								/*OZEL TÜMÜ*/
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=0, H.ID, NULL)) AS OZL_TUMU_DOSYALAR,		
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0, H.ID, NULL)) AS OZL_TUMU_DOSYA_ADET,		
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.ADET
									END 
								),0) AS OZL_TUMU_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0)=0 AND (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) > 0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) = 0  THEN HD.ADET
									END 
								),2) AS OZL_TUMU_ONARIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS OZL_TUMU_SISTEM,
								 TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS OZL_TUMU_GERCEKLESEN,	
								TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) 
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN HD.BIRIM_FIYAT_GERCEK
										END  
								),2) AS OZL_TUMU_SISTEM_ISCILIK,
								TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
								),2) AS OZL_TUMU_GERCEK_ISCILIK,
								
								
								/*3_1 ÖZEL  ORJ*/																
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0), H.ID, NULL)) AS ORJ_OZEL_DOSYA_ADET,																											
								TRUNCATE(SUM( 
									CASE											
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET									
									ELSE 0
									END 								  															
								),0) AS ORJ_OZEL_DEGISIM_ADET,																							
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 								  															
								),2) AS ORJ_OZEL_SISTEM,								
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 								  															
									)
								,2) AS ORJ_OZEL_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) 
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS ORJ_OZEL_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS ORJ_OZEL_GERCEK_ISCILIK,
								/*3_1 END */

								/*3_2 ÖZEL  LO EÞD*/
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) , H.ID, NULL)) AS LOESD_OZEL_DOSYA_ADET,		
								TRUNCATE(SUM( 
								CASE 								
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
								ELSE 0
								END 
								),0) AS LOESD_OZEL_DEGISIM_ADET,								
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 
								),2) AS LOESD_OZEL_SISTEM,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0   OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND SD.ESDEGER_OLABILIR_SEBEP>0) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 
								),2) AS LOESD_OZEL_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS LOESD_OZEL_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS LOESD_OZEL_GERCEK_ISCILIK,
								/* 3_2 END */

																
								
								/*1 YETKILI ANLASMASIZ*/
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=1  AND IFNULL(H.ANLASMALI, 0)=0, H.ID, NULL)) AS YET_ASIZ_DOSYALAR,
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0, H.ID, NULL)) AS YET_ASIZ_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									END 
								),0) AS YET_ASIZ_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0)  =1 AND IFNULL(H.ANLASMALI, 0)=0 AND (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) >0 THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN HD.ADET
									END 
								),2) AS YET_ASIZ_ONARIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS YET_ASIZ_SISTEM,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS YET_ASIZ_GERCEKLESEN,	
								TRUNCATE(SUM(
									CASE
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0)  =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0)  =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS YET_ASIZ_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 THEN   (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS YET_ASIZ_GERCEK_ISCILIK,
								/*END */

								/*2 YETKILI ANLASMALI*/
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=1  AND IFNULL(H.ANLASMALI, 0)=1, H.ID, NULL)) AS YET_ALI_DOSYALAR,
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1, H.ID, NULL)) AS YET_ALI_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									END 
								),0) AS YET_ALI_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) >0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN HD.ADET
									END 
								),2) AS YET_ALI_ONARIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS YET_ALI_SISTEM,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS YET_ALI_GERCEKLESEN,	
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS YET_ALI_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS YET_ALI_GERCEK_ISCILIK,
								/*END */
																
								/*YETKÝLÝ ORJS*/								
									/*Y_1 YETKÝLÝ  ORJ*/
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0), H.ID, NULL)) AS ORJ_YET_DOSYA_ADET,																				
									TRUNCATE(SUM( 
										CASE											
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
										ELSE 0
										END 								  															
									),0) AS ORJ_YET_DEGISIM_ADET,															
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
										ELSE 0
										END 								  															
									),2) AS ORJ_YET_SISTEM,									
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										ELSE 0
										END 								  															
										),2)
									 AS ORJ_YET_GERCEKLESEN,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) 
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK
										END  
									),2) AS ORJ_YET_SISTEM_ISCILIK,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS ORJ_YET_GERCEK_ISCILIK,
									/*Y_1 END */

									/*Y_2 YETKÝLÝ  LO EÞD */
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)), H.ID, NULL)) AS LOESD_YET_DOSYA_ADET,		
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									ELSE 0
									END 
									),0) AS LOESD_YET_DEGISIM_ADET,									
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR(IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 
									),2) AS LOESD_YET_SISTEM,
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1  AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 
									),2) AS LOESD_YET_GERCEKLESEN,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) 
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS LOESD_YET_SISTEM_ISCILIK,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0  AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS LOESD_YET_GERCEK_ISCILIK,
									/* Y_2 END */									


									/*Y_1 YETKÝLÝ  ANLAÞMASIZ ORJ*/	
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0), H.ID, NULL)) AS ORJ_YET_ASIZ_DOSYA_ADET,
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN HD.ADET
										ELSE 0
										END 								  															
									),0) AS ORJ_YET_ASIZ_DEGISIM_ADET,																
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
										ELSE 0
										END 								  															
									),2) AS ORJ_YET_ASIZ_SISTEM,									
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.YAN_SANAYI=0)  THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										ELSE 0
										END 								  															
									),2)
									AS ORJ_YET_ASIZ_GERCEKLESEN,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK
										END  
									),2) AS ORJ_YET_ASIZ_SISTEM_ISCILIK,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS ORJ_YET_ASIZ_GERCEK_ISCILIK,
									/*Y_1 END */

									/*Y_2 YETKÝLÝ ANLAÞMASIZ LO*/
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID, 0) = 1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)), H.ID, NULL)) AS LOESD_YET_ASIZ_DOSYA_ADET,
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									ELSE 0
									END 
									),0) AS LOESD_YET_ASIZ_DEGISIM_ADET,									
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 
									),2) AS LOESD_YET_ASIZ_SISTEM,
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 
									),2) AS LOESD_YET_ASIZ_GERCEKLESEN,
									TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK
									END  
									),2) AS LOESD_YET_ASIZ_SISTEM_ISCILIK,
									TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
									),2) AS LOESD_YET_ASIZ_GERCEK_ISCILIK,

									/* Y_2 END */									


									/*Y_1 YETKÝLÝ  ANLAÞMALI ORJ*/
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) , H.ID, NULL)) AS ORJ_YET_ALI_DOSYA_ADET,
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1  AND SD.STATUS=1)  THEN HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1  AND SD.STATUS=1)  THEN HD.ADET
										ELSE 0
										END 								  															
									),0) AS ORJ_YET_ALI_DEGISIM_ADET,																
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
										ELSE 0
										END 								  															
									),2) AS ORJ_YET_ALI_SISTEM,									
									TRUNCATE(SUM( 
										CASE		
										WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
										ELSE 0
										END 								  															
									),2) AS ORJ_YET_ALI_GERCEKLESEN,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK
										END  
									),2) AS ORJ_YET_ALI_SISTEM_ISCILIK,
									TRUNCATE(SUM(
										CASE 
											WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
											WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
										END  
									),2) AS ORJ_YET_ALI_GERCEK_ISCILIK,
									/*Y_1 END */

									/*Y_2 YETKÝLÝ ANLASMALI  LO*/
									COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR ( IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)), H.ID, NULL)) AS LOESD_YET_ALI_DOSYA_ADET,
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR ((SD.ESDEGER_OLABILIR_SEBEP=2) OR IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR ((SD.ESDEGER_OLABILIR_SEBEP=2) OR IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.ADET
									ELSE 0
									END 
									),0) AS LOESD_YET_ALI_DEGISIM_ADET,									
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 OR (SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 OR (SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 
									),2) AS LOESD_YET_ALI_SISTEM,
									TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2)  OR (IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 
									),2) AS LOESD_YET_ALI_GERCEKLESEN,
									TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK
									END  
									),2) AS LOESD_YET_ALI_SISTEM_ISCILIK,
									TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =1 AND IFNULL(H.ANLASMALI, 0)=1 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
									),2) AS LOESD_YET_ALI_GERCEK_ISCILIK,

									/* Y_2 END */
									
								
								/*3 ÖZEL ANLASMASIZ*/
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=0  AND IFNULL(H.ANLASMALI, 0)=0, H.ID, NULL)) AS OZEL_ASIZ_DOSYALAR,
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0, H.ID, NULL)) AS OZEL_ASIZ_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									END 
								),0) AS OZEL_ASIZ_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND ((IFNULL(HD.SOKTAK,0) + IFNULL(HD.BOYA_TUTAR,0) + IFNULL(HD.TAMIR,0))>0) THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN HD.ADET
									END 
								),2) AS OZEL_ASIZ_ONARIM_ADET,								
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS OZEL_ASIZ_SISTEM,
								 TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS OZEL_ASIZ_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS OZEL_ASIZ_SISTEM_ISCILIK,	
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS OZEL_ASIZ_GERCEK_ISCILIK,								
								/*END */
								
								/*3_1 ÖZEL  ORJ*/	
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0), H.ID, NULL)) AS ORJ_OZEL_ASIZ_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
									ELSE 0
									END 								  															
								),0) AS ORJ_OZEL_ASIZ_DEGISIM_ADET,								
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 								  															
								),2)
								AS ORJ_OZEL_ASIZ_SISTEM,								
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 								  															
								),2)
								AS ORJ_OZEL_ASIZ_GERCEKLESEN,
								
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =0 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS ORJ_OZEL_ASIZ_GERCEK_ISCILIK,
								
								/*3_1 END */
								
								/*3_2 ÖZEL ANLAÞMASIZ LO EÞD*/
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND (IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(SD.YAN_SANAYI, 0) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1)  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32))), H.ID, NULL)) AS LOESD_OZEL_ASIZ_DOSYA_ADET,
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
								ELSE 0
								END 
								),2) AS LOESD_OZEL_ASIZ_SISTEM,
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
								ELSE 0
								END 
								),2) AS LOESD_OZEL_ASIZ_GERCEKLESEN,
								TRUNCATE(SUM(
								CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
									WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
									WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK
								END  
								),2) AS LOESD_OZEL_ASIZ_SISTEM_ISCILIK,
								TRUNCATE(SUM(
								CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
									WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
									WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=0 AND IFNULL(HD.YS_ISKONTO, 0) > 0 THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
								END  
								),2) AS LOESD_OZEL_ASIZ_GERCEK_ISCILIK,

								/* 3_2 END */
																

								/*4 ÖZEL ANLAÞMALI*/
								GROUP_CONCAT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0)=0  AND IFNULL(H.ANLASMALI, 0)=1, H.ID, NULL)) AS OZEL_ALI_DOSYALAR,
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1, H.ID, NULL)) AS OZEL_ALI_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									END 
								),0) AS OZEL_ALI_DEGISIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))>0 THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=2 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.ADET
									WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN HD.ADET
									END 
								),2) AS OZEL_ALI_ONARIM_ADET,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									END 
								),2) AS OZEL_ALI_SISTEM,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									END 
								),2) AS OZEL_ALI_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS OZEL_ALI_SISTEM_ISCILIK,
								
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1  THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS OZEL_ALI_GERCEK_ISCILIK,
								/*END */
								
								/*3_1 ÖZEL ALI  ORJ*/																
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0), H.ID, NULL)) AS ORJ_OZEL_ALI_DOSYA_ADET,
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.ADET
									ELSE 0
									END 								  															
								),0) AS ORJ_OZEL_ALI_DEGISIM_ADET,														
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 								  															
								),2) AS ORJ_OZEL_ALI_SISTEM,								
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  ((IFNULL(HD.YS_ISKONTO,0)=0 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) OR SD.STATUS=1 AND IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 								  															
								),2)
								AS ORJ_OZEL_ALI_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0))
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN (IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0))
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS ORJ_OZEL_ALI_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0) =1 AND  (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) OR (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=0)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS ORJ_OZEL_ALI_GERCEK_ISCILIK,
								/*3_1 END */

								/*4_2 ÖZEL ANLAÞMALI LO*/
								COUNT(DISTINCT IF(IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND ( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)), H.ID, NULL)) AS LOESD_OZEL_ALI_DOSYA_ADET,
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
								ELSE 0
								END 
								),2) AS LOESD_OZEL_ALI_SISTEM,
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1   AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1))  OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND SD.ESDEGER_OLABILIR_SEBEP=2) OR (IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND  IFNULL(  HD.SIPARIS_VERMEME_SEBEP_ID,  0  ) IN (3, 4, 30, 31, 32)) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
								ELSE 0
								END 
								),2) AS LOESD_OZEL_ALI_GERCEKLESEN,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK
									END  
								),2) AS LOESD_OZEL_ALI_SISTEM_ISCILIK,
								TRUNCATE(SUM(
									CASE 
										WHEN HD.ISLEM=1 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID=0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0)+IFNULL(HD.TAMIR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=2 AND HD.MINI_ID<>0 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN  +IFNULL(HD.SOKTAK,0) +IFNULL(HD.BOYA_TUTAR,0) * (1-HD.ISC_ISKONTO/100)
										WHEN HD.ISLEM=3 AND IFNULL(H.SERVIS_TUR_ID,0) =0 AND IFNULL(H.ANLASMALI, 0)=1 AND (( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=1)) THEN HD.BIRIM_FIYAT_GERCEK - (HD.BIRIM_FIYAT_GERCEK * HD.ISC_ISKONTO / 100)
									END  
								),2) AS LOESD_OZEL_ALI_GERCEK_ISCILIK,
								/* 4_2 END */
								
								/*TED_ORJ*/
								COUNT(DISTINCT IF(SD.YAN_SANAYI=0 AND SD.STATUS=1 , H.ID, NULL)) AS TED_ORJ_DOSYA_ADET,																			
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.ADET
									ELSE 0
									END 								  															
								),0) AS TED_ORJ_DEGISIM_ADET,																						
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 								  															
								),2) AS TED_ORJ_SISTEM,								
								TRUNCATE(SUM( 
									CASE		
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)<>1 AND SD.STATUS=1)  THEN HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 								  															
									),2)
								 AS TED_ORJ_GERCEKLESEN,
								/*3_1 END */


								/*3_2 TED_LO*/
								COUNT(DISTINCT IF(( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1)  OR (SD.ESDEGER_OLABILIR_SEBEP=2)), H.ID, NULL)) AS TED_LO_DOSYA_ADET,		
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.ADET
								ELSE 0
								END 
								),0) AS TED_LO_DEGISIM_ADET,								
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
									WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									ELSE 0
									END 
								),2) AS TED_LO_SISTEM,
								TRUNCATE(SUM( 
									CASE 
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1  AND IFNULL(SD.STATUS, 0) IN (0,1) AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
									WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=1))  OR (SD.ESDEGER_OLABILIR_SEBEP=2) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
									ELSE 0
									END 
								),2) AS TED_LO_GERCEKLESEN,
								/* 3_2 END */

								/* 3_3 TED_ESD */
								COUNT(DISTINCT IF(( HD.SIPARIS_SECENEK = 2 AND IFNULL(HD.YS_ISKONTO, 0) = 0) AND (HD.SIPARIS_SECENEK=1 AND SD.YAN_SANAYI=1 AND SD.LO=0)  OR (SD.ESDEGER_OLABILIR_SEBEP=1), H.ID, NULL)) AS TED_ESD_DOSYA_ADET,		
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  HD.ADET
								ELSE 0
								END 
								),0) AS TED_ESD_DEGISIM_ADET,								
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.VERITABANINDA,0) =  1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  HD.BIRIM_FIYAT_SISTEM * HD.ADET
								WHEN IFNULL(HD.VERITABANINDA,0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
								ELSE 0
								END 
								),2) AS TED_ESD_SISTEM,
								TRUNCATE(SUM( 
								CASE 
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) = 1  AND IFNULL(SD.STATUS, 0) IN (0,1) AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  HD.BIRIM_FIYAT_GERCEK * HD.ADET
								WHEN IFNULL(HD.SIPARIS_SECENEK, 0) <> 1 AND HD.ISLEM=1 AND ( (HD.SIPARIS_SECENEK=1 AND IFNULL(SD.YAN_SANAYI,0)=1 AND IFNULL(SD.LO,0)=0)) OR (SD.ESDEGER_OLABILIR_SEBEP=1) THEN  ((HD.BIRIM_FIYAT_GERCEK - ((HD.BIRIM_FIYAT_GERCEK * IFNULL(HD.KHHH_ISKONTO, 0) / 100))) * HD.ADET)
								ELSE 0
								END 
								),2) AS TED_ESD_GERCEKLESEN,
								/* 3_3 END */
								/* END */
																
								SU.NAME AS TEDARIKCI																													
							FROM
								".$this->hasarTable."  H
							INNER JOIN HASAR_DETAIL HD ON H.ONAY_NO = HD.ONAY_NO														
							LEFT JOIN HASAR_MAGDUR_ARACLAR HMA ON H.ONAY_NO = HMA.ONAY_NO
							LEFT JOIN SIPARIS_DETAIL SD ON HD.ID = SD.YEDPAR_ID AND SD.STATUS=1							
							LEFT JOIN USERS U ON H.USER_EKSPER = U.U_NAME																					
							LEFT JOIN SIPARIS S ON S.ID = SD.SIPARIS_ID
							LEFT JOIN SIPARIS_USERS SU ON S.TEDARIKCI_ID = SU.ID
							LEFT JOIN HKMEKS_DOSYA_ONAY HDO ON HDO.DOSYA_ID = H.ID	
							WHERE
								1 = 1	
							AND HD.ISLEM = 1								
							AND IFNULL(H.PERT, 0) <> 1														
							AND IFNULL(H.TALEPSIZ, 0) <> 1											
							AND H.DOSYA_STATU = '1'														
							AND IFNULL(HDO.DURUM_ID, 0) <> 2
							$kriter													
							";								
							//echo $sql;							
							if (!($this->cdb->execute_sql($sql,$result,$error_msg))){return false;}			
							while($row = mysql_fetch_array($result)){			
							$data_arr[] = $row;
							}
							return $data_arr;	
		}
		
		
		function tedarikYedekParca($brans,$tarih1,$tarih2,$marka_id,$kullanim_sekli,$tedarikci,$sehir_id,$eksper,$rapor_secim,$siparis_uygun,$eksperli,$filo_haric,$filo_acenteler,$arac_yasi,$police_kodu){ 
			
			if( ($this->kullaniciKontrol() == '2' || $this->hdsKullaniciKriter) ) { return false;}
						
			if($brans!=NULL && $brans!=-1){ 
				$kriter .=  " AND H.SIGORTA_SEKLI='$brans'";
			}
						
			if(($tarih1 && $tarih2)){				
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			} else {					
				$tarih1 = date("Y-m-d", mktime(0, 0, 0, date("01") , date("01"), date("Y")));
				$tarih2 = date("Y-m-d", mktime(0, 0, 0, date("m") , date("d"), date("Y")));	
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			}
			
			if($arac_yasi){
				if($arac_yasi>9){ 
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) > 9 "; 
				} else {
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) IN ($arac_yasi) ";
				}
			}
			
			if($police_kodu){
				$kriter .= " AND H.POLICE_NO IN ($police_kodu)";
			}

			if ($filo_haric == 1){
				$acente_arr = explode(",",$filo_acenteler);
				$acente_str = implode("','",$acente_arr);
				$kriter .= " AND H.SB_ACENTE_KODU NOT IN ('".$acente_str."')";
			}			
			
			if(($kullanim_sekli!=NULL && $kullanim_sekli!='-1')){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.SB_ARAC_KULLANIM_TURU , H.SB_ARAC_KULLANIM_TURU)='$kullanim_sekli'";
			}			
			
			if(($tedarikci!=NULL &&  $tedarikci!='-1')){ 
				$kriter .=  " AND S.TEDARIKCI_ID='$tedarikci'";
			}

			if(($sehir_id!=NULL &&  $sehir_id!='-1')){ 
				$kriter .=  " AND SR.IL='$sehir_id'";
			}

			if(($eksper!=NULL &&  $eksper!='-1')){ 
				$kriter .=  " AND H.USER_EKSPER='$eksper'";
			}

			if($marka_id!=NULL && $marka_id!='-1'){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.MARKA_ID , H.HAS_MARKA_ID)='$marka_id'";
			}

			if($siparis_uygun==1)	{
				$kriter .=  " AND H.SIPARIS_UYGUN = '1'";			
			}
			if($eksperli==1)	{
				$kriter .=  " AND IFNULL(H.SERVIS_DOSYA, 0) = 0";			
			}			
				
			$sql = "		SELECT
								SU. NAME AS TEDARIKCI,									
								/* Orj. Ted. */								
								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL( SD.LO, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 , HD.ADET, 0 ) ) AS TED_ORJ_DEGISIM_ADET,

								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 , HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) ) AS TED_ORJ_SISTEM,
										 
								TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 , HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) ),2) - TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 , ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay) * HD.ADET, 0 ) ),2) AS TED_ORJ_GERCEKLESEN, 
								
								/* Eþdeðer */								

								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.ADET,  0  )  ) AS TED_ESD_DEGISIM_ADET,

								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) AS TED_ESD_SISTEM,

								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) - SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 OR ( SD.ESDEGER_OLABILIR_SEBEP = 1), ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay) * HD.ADET, 0 ) ) AS TED_ESD_GERCEKLESEN,
								
								/* LO */
								
								SUM(    IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.ADET,  0  )  ) AS TED_LO_DEGISIM_ADET,

								SUM(  IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) AS TED_LO_SISTEM,

								SUM(  IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) - SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 OR ( SD.ESDEGER_OLABILIR_SEBEP = 2), ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay ) * HD.ADET, 0 ) ) AS TED_LO_GERCEKLESEN								

							FROM								
								HASAR_DETAIL HD
								INNER JOIN ".$this->hasarTable."  H ON H.ONAY_NO = HD.ONAY_NO 					
								INNER JOIN SERVIS SR ON SR.ID = H.SERVIS_ID 
								LEFT JOIN HASAR_MAGDUR_ARACLAR HMA ON H.ONAY_NO = HMA.ONAY_NO								
								LEFT JOIN SIPARIS_DETAIL SD ON SD.YEDPAR_ID = HD.ID AND SD.STATUS=1										
								LEFT JOIN SIPARIS S ON S.ID = SD.SIPARIS_ID								
								LEFT JOIN HKMEKS_DOSYA_ONAY HDO ON HDO.DOSYA_ID = H.ID	
								LEFT JOIN SIPARIS_USERS SU ON S.TEDARIKCI_ID = SU.ID	
								LEFT JOIN USERS U ON H.USER_EKSPER = U.U_NAME										
							WHERE
								1
								AND HD.ISLEM = 1 	
								AND H.DOSYA_STATU =1													
								AND H.SIPARIS_UYGUN = 1 
								AND IF(HD.YS_ISKONTO>0,1,H.ISKONTO_TEDARIKCI>0)
								#AND IFNULL(H.SERVIS_DOSYA, 0) = 0
								AND IFNULL(H.TALEPSIZ,0) <> 1 
								AND IFNULL(H.PERT, 0) <> 1
								AND IFNULL(HDO.DURUM_ID,0) <> 2									
								$kriter		
								ORDER BY TED_ORJ_GERCEKLESEN DESC								
							";
							//echo $sql;
			if (!($this->cdb->execute_sql($sql,$result,$error_msg))){return false;}			
			$row = mysql_fetch_array($result);			
			return $row;	
		}
		
		function tedarikOrijinalBlok($brans,$tarih1,$tarih2,$marka_id,$kullanim_sekli,$tedarikci,$sehir_id,$eksper,$rapor_secim,$siparis_uygun,$eksperli,$filo_haric,$filo_acenteler,$arac_yasi,$police_kodu){
			
			if( ($this->kullaniciKontrol() == '2' || $this->hdsKullaniciKriter) ) { return false;}
						
			if($brans!=NULL && $brans!=-1){ 
				$kriter .=  " AND H.SIGORTA_SEKLI='$brans'";
			}
						
			if(($tarih1 && $tarih2)){				
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			} else {					
				$tarih1 = date("Y-m-d", mktime(0, 0, 0, date("01") , date("01"), date("Y")));
				$tarih2 = date("Y-m-d", mktime(0, 0, 0, date("m") , date("d"), date("Y")));	
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			}
			
			if($arac_yasi){
				if($arac_yasi>9){ 
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) > 9 "; 
				} else {
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) IN ($arac_yasi) ";
				}
			}
			
			if($police_kodu){
				$kriter .= " AND H.POLICE_NO IN ($police_kodu)";
			}

			if ($filo_haric == 1){
				$acente_arr = explode(",",$filo_acenteler);
				$acente_str = implode("','",$acente_arr);
				$kriter .= " AND H.SB_ACENTE_KODU NOT IN ('".$acente_str."')";
			}			
			
			if(($kullanim_sekli!=NULL && $kullanim_sekli!='-1')){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.SB_ARAC_KULLANIM_TURU , H.SB_ARAC_KULLANIM_TURU)='$kullanim_sekli'";
			}			
			
			if(($tedarikci!=NULL &&  $tedarikci!='-1')){ 
				$kriter .=  " AND S.TEDARIKCI_ID='$tedarikci'";
			}

			if(($sehir_id!=NULL &&  $sehir_id!='-1')){ 
				$kriter .=  " AND SR.IL='$sehir_id'";
			}

			if(($eksper!=NULL &&  $eksper!='-1')){ 
				$kriter .=  " AND H.USER_EKSPER='$eksper'";
			}

			if($marka_id!=NULL && $marka_id!='-1'){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.MARKA_ID , H.HAS_MARKA_ID)='$marka_id'";
			}	
			
			if($siparis_uygun==1)	{
				$kriter .=  " AND H.SIPARIS_UYGUN = '1'";			
			}
			if($eksperli==1)	{
				$kriter .=  " AND IFNULL(H.SERVIS_DOSYA, 0) = 0";			
			}
				
			$sql = "		SELECT
								SU. NAME AS TEDARIKCI,	
								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL( SD.LO, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, HD.ADET, 0 ) ) AS TED_ORJ_DEGISIM_ADET,

								SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) ) AS TED_ORJ_SISTEM,
												
								TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, HD.BIRIM_FIYAT_SISTEM * HD.ADET, 0 ) ),2) - TRUNCATE(SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) <> 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1, ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay) * HD.ADET, 0 ) ),2) AS TED_ORJ_GERCEKLESEN 

							FROM
								HASAR_DETAIL HD
								INNER JOIN ".$this->hasarTable."  H ON H.ONAY_NO = HD.ONAY_NO 	
								INNER JOIN SERVIS SR ON SR.ID = H.SERVIS_ID 								
								LEFT JOIN HASAR_MAGDUR_ARACLAR HMA ON H.ONAY_NO = HMA.ONAY_NO								
								LEFT JOIN SIPARIS_DETAIL SD ON SD.YEDPAR_ID = HD.ID AND SD.STATUS=1										
								LEFT JOIN SIPARIS S ON S.ID = SD.SIPARIS_ID
								LEFT JOIN HKMEKS_DOSYA_ONAY HDO ON HDO.DOSYA_ID = H.ID	
								LEFT JOIN SIPARIS_USERS SU ON S.TEDARIKCI_ID = SU.ID	
								LEFT JOIN USERS U ON H.USER_EKSPER = U.U_NAME									
							WHERE
								1
								AND HD.ISLEM = 1 	
								AND H.DOSYA_STATU =1													
								AND H.SIPARIS_UYGUN = 1 
								-- AND IFNULL(H.SERVIS_DOSYA, 0) = 0
								AND IF(HD.YS_ISKONTO>0,1,H.ISKONTO_TEDARIKCI>0)
								AND IFNULL(H.TALEPSIZ,0) <> 1 
								AND IFNULL(H.PERT, 0) <> 1
								AND IFNULL(HDO.DURUM_ID,0) <> 2	
								AND (IFNULL(SD.YAN_SANAYI,0)=0 OR IFNULL(SD.ESDEGER_OLABILIR_SEBEP,0)=0)								
								$kriter									
							GROUP BY SU.ID		
							HAVING 	TED_ORJ_DEGISIM_ADET>0	
							ORDER BY TED_ORJ_GERCEKLESEN DESC
							";								
							//echo $sql;							
			if (!($this->cdb->execute_sql($sql,$result,$error_msg))){return false;}			
			while($row = mysql_fetch_array($result)){			
			$data_arr[] = $row;
			}
			return $data_arr;	
		}
		
		

		function tedarikLogosuzBlok($brans,$tarih1,$tarih2,$marka_id,$kullanim_sekli,$tedarikci,$sehir_id,$eksper,$rapor_secim,$siparis_uygun,$eksperli,$filo_haric,$filo_acenteler,$arac_yasi,$police_kodu){ 
			
			if( ($this->kullaniciKontrol() == '2' || $this->hdsKullaniciKriter) ) { return false;}
						
			if($brans!=NULL && $brans!=-1){ 
				$kriter .=  " AND H.SIGORTA_SEKLI='$brans'";
			}
						
			if(($tarih1 && $tarih2)){				
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			} else {					
				$tarih1 = date("Y-m-d", mktime(0, 0, 0, date("01") , date("01"), date("Y")));
				$tarih2 = date("Y-m-d", mktime(0, 0, 0, date("m") , date("d"), date("Y")));	
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			}
			
			if($arac_yasi){
				if($arac_yasi>9){ 
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) > 9 "; 
				} else {
					$kriter .= " AND IF(H.SIGORTA_SEKLI=1, YEAR(NOW()) - HMA.MODEL_YILI, YEAR(NOW()) - H.HAS_MODEL_YILI) IN ($arac_yasi) ";
				}
			}
			
			if($police_kodu){
				$kriter .= " AND H.POLICE_NO IN ($police_kodu)";
			}

			if ($filo_haric == 1){
				$acente_arr = explode(",",$filo_acenteler);
				$acente_str = implode("','",$acente_arr);
				$kriter .= " AND H.SB_ACENTE_KODU NOT IN ('".$acente_str."')";
			}			
			
			if(($kullanim_sekli!=NULL && $kullanim_sekli!='-1')){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.SB_ARAC_KULLANIM_TURU , H.SB_ARAC_KULLANIM_TURU)='$kullanim_sekli'";
			}			
			
			if(($tedarikci!=NULL &&  $tedarikci!='-1')){ 
				$kriter .=  " AND S.TEDARIKCI_ID='$tedarikci'";
			}	
				
			if(($sehir_id!=NULL &&  $sehir_id!='-1')){ 
				$kriter .=  " AND SR.IL='$sehir_id'";
			}

			if(($eksper!=NULL &&  $eksper!='-1')){ 
				$kriter .=  " AND H.USER_EKSPER='$eksper'";
			}

			if($marka_id!=NULL && $marka_id!='-1'){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.MARKA_ID , H.HAS_MARKA_ID)='$marka_id'";
			}
			
			if($siparis_uygun==1)	{
				$kriter .=  " AND H.SIPARIS_UYGUN = '1'";			
			}
			if($eksperli==1)	{
				$kriter .=  " AND IFNULL(H.SERVIS_DOSYA, 0) = 0";			
			}
				
			$sql = "		SELECT
								SU. NAME AS TEDARIKCI,	
								SUM(    IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.ADET,  0  )  ) AS TED_LO_DEGISIM_ADET,

								SUM(  IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) AS TED_LO_SISTEM,

								SUM(  IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 1  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) - SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 1 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=2), ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay ) * HD.ADET, 0 ) ) AS TED_LO_GERCEKLESEN
							FROM
								HASAR_DETAIL HD
								INNER JOIN ".$this->hasarTable."  H ON H.ONAY_NO = HD.ONAY_NO 	
								INNER JOIN SERVIS SR ON SR.ID = H.SERVIS_ID 		
								LEFT JOIN HASAR_MAGDUR_ARACLAR HMA ON H.ONAY_NO = HMA.ONAY_NO								
								LEFT JOIN SIPARIS_DETAIL SD ON SD.YEDPAR_ID = HD.ID AND SD.STATUS=1										
								LEFT JOIN SIPARIS S ON S.ID = SD.SIPARIS_ID
								LEFT JOIN HKMEKS_DOSYA_ONAY HDO ON HDO.DOSYA_ID = H.ID	
								LEFT JOIN SIPARIS_USERS SU ON S.TEDARIKCI_ID = SU.ID	
								LEFT JOIN USERS U ON H.USER_EKSPER = U.U_NAME																	
							WHERE
								1
								AND HD.ISLEM = 1 	
								AND H.DOSYA_STATU =1													
								AND H.SIPARIS_UYGUN = 1 
								-- AND IFNULL(H.SERVIS_DOSYA, 0) = 0
								AND IF(HD.YS_ISKONTO>0,1,H.ISKONTO_TEDARIKCI>0)
								AND IFNULL(H.TALEPSIZ,0) <> 1 
								AND IFNULL(H.PERT, 0) <> 1
								AND IFNULL(HDO.DURUM_ID,0) <> 2	
								AND 
								(IFNULL(SD.YAN_SANAYI,0)=1 
									AND IFNULL(SD.LO,0)=1 OR (SD.ESDEGER_OLABILIR_SEBEP=2)
								)
								$kriter									
							GROUP BY SU.ID	
							HAVING 	TED_LO_DEGISIM_ADET>0
							ORDER BY TED_LO_GERCEKLESEN DESC							
							";	
							//echo $sql;	
			if (!($this->cdb->execute_sql($sql,$result,$error_msg))){return false;}			
			while($row = mysql_fetch_array($result)){			
			$data_arr[] = $row;
			}
			return $data_arr;	
		}		
		
		function tedarikEsdegerBlok($brans,$tarih1,$tarih2,$marka_id,$kullanim_sekli,$tedarikci,$sehir_id,$eksper,$rapor_secim,$siparis_uygun,$eksperli,$filo_haric,$filo_acenteler,$arac_yasi,$police_kodu){ 
			
			if( ($this->kullaniciKontrol() == '2' || $this->hdsKullaniciKriter) ) { return false;}
						
			if($brans!=NULL && $brans!=-1){ 
				$kriter .=  " AND H.SIGORTA_SEKLI='$brans'";
			}
						
			if(($tarih1 && $tarih2)){				
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			} else {					
				$tarih1 = date("Y-m-d", mktime(0, 0, 0, date("01") , date("01"), date("Y")));
				$tarih2 = date("Y-m-d", mktime(0, 0, 0, date("m") , date("d"), date("Y")));	
				$kriter .=  " AND H.KAYIT_TARIH_SAAT BETWEEN '$tarih1 00:00:00' AND '$tarih2 23:59:59'";
			}										
			
			if(($kullanim_sekli!=NULL && $kullanim_sekli!='-1')){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.SB_ARAC_KULLANIM_TURU , H.SB_ARAC_KULLANIM_TURU)='$kullanim_sekli'";
			}			
			
			if(($tedarikci!=NULL &&  $tedarikci!='-1')){ 
				$kriter .=  " AND S.TEDARIKCI_ID='$tedarikci'";
			}	

			if(($sehir_id!=NULL &&  $sehir_id!='-1')){ 
				$kriter .=  " AND SR.IL='$sehir_id'";
			}

			if(($eksper!=NULL &&  $eksper!='-1')){ 
				$kriter .=  " AND H.USER_EKSPER='$eksper'";
			}

			if($marka_id!=NULL && $marka_id!='-1'){ 
				$kriter .=  " AND IF(H.SIGORTA_SEKLI=1,  HMA.MARKA_ID , H.HAS_MARKA_ID)='$marka_id'";
			}	
			
			if($siparis_uygun==1)	{
				$kriter .=  " AND H.SIPARIS_UYGUN = '1'";			
			}
			if($eksperli==1)	{
				$kriter .=  " AND IFNULL(H.SERVIS_DOSYA, 0) = 0";			
			}
				
			$sql = "		SELECT
								SU. NAME AS TEDARIKCI,	
								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.ADET,  0  )  ) AS TED_ESD_DEGISIM_ADET,

								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) AS TED_ESD_SISTEM,

								SUM( IF (  IFNULL(SD.ID, 0) > 0  AND IFNULL(  SD.YAN_SANAYI,  0  ) = 1  AND IFNULL(SD.LO, 0) = 0  AND IFNULL(SD. STATUS, 0) = 1  AND IFNULL(  HD.SIPARIS_SECENEK,  0  ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1),  HD.BIRIM_FIYAT_SISTEM * HD.ADET,  0  )  ) - SUM( IF ( IFNULL(SD.ID, 0) > 0 AND IFNULL( SD.YAN_SANAYI, 0 ) = 1 AND IFNULL(SD.LO, 0) = 0 AND IFNULL(SD. STATUS, 0) = 1 AND IFNULL( HD.SIPARIS_SECENEK, 0 ) = 1 OR (SD.ESDEGER_OLABILIR_SEBEP=1), ( HD.BIRIM_FIYAT_SISTEM - HD.BIRIM_FIYAT_GERCEK $ans_isk_detay) * HD.ADET, 0 ) ) AS TED_ESD_GERCEKLESEN

							FROM
								HASAR_DETAIL HD
								INNER JOIN ".$this->hasarTable."  H ON H.ONAY_NO = HD.ONAY_NO 
								INNER JOIN SERVIS SR ON SR.ID = H.SERVIS_ID 	
								LEFT JOIN HASAR_MAGDUR_ARACLAR HMA ON H.ONAY_NO = HMA.ONAY_NO								
								LEFT JOIN SIPARIS_DETAIL SD ON SD.YEDPAR_ID = HD.ID AND SD.STATUS=1										
								LEFT JOIN SIPARIS S ON S.ID = SD.SIPARIS_ID
								LEFT JOIN HKMEKS_DOSYA_ONAY HDO ON HDO.DOSYA_ID = H.ID	
								LEFT JOIN SIPARIS_USERS SU ON S.TEDARIKCI_ID = SU.ID	
								LEFT JOIN USERS U ON H.USER_EKSPER = U.U_NAME																	
							WHERE
								1
								AND HD.ISLEM = 1 	
								AND H.DOSYA_STATU =1													
								AND H.SIPARIS_UYGUN = 1 
								AND IF(HD.YS_ISKONTO>0,1,H.ISKONTO_TEDARIKCI>0)
								AND IFNULL(H.TALEPSIZ,0) <> 1 
								AND IFNULL(H.PERT, 0) <> 1
								AND IFNULL(HDO.DURUM_ID,0) <> 2	
								AND 
								(IFNULL(SD.YAN_SANAYI,0)=1 
									AND IFNULL(SD.LO,0)=0 OR (SD.ESDEGER_OLABILIR_SEBEP=1)
								)
								$kriter																								
							GROUP BY SU.ID	
							HAVING 	TED_ESD_DEGISIM_ADET>0	
							ORDER BY TED_ESD_GERCEKLESEN DESC
							";															
			if (!($this->cdb->execute_sql($sql,$result,$error_msg))){return false;}			
			while($row = mysql_fetch_array($result)){			
			$data_arr[] = $row;
			}
			return $data_arr;	
		}		
		
		
		function modul_aktif_kontrol(){
			
			$modul_eksper				= false;
			$modul_servis				= false;
			$modul_faturali 			= false; 
			$modul_cam 					= false; 
			$modul_tedarik				= false; 
			$modul_mobil				= false; 			
			$modul_otodisi 				= false;
			$modul_arastirmaci 			= false;
			$modul_uzman 				= false;
			$modul_alternatif_tamir 	= false;
			
			//firma id lere göre aktif mi kontrol ediliyor.
			$eksper_aktif_modul_kontrol				= array(18,19,20,23,24,27,28,30,32,37,42,44,47,48,49,50,51,55,56,58,60,64,70,75,80,143,144,145,156,157);
			$servis_aktif_modul_kontrol				= array(18,19,20,27,28,30,37,42,44,47,50,51,55,56,60,64,75,143,144,145,156,157);
			$faturali_aktif_modul_kontrol			= array(18,19,20,24,28,30,32,37,42,44,47,48,49,50,51,55,56,58,60,64,70,75,80,143,144,145,156,157);
			$cam_aktif_modul_kontrol				= array(19,20,24,27,28,30,32,37,42,44,47,48,50,55,56,58,64,75,80,143,144,145,156,157);
			$tedarik_aktif_modul_kontrol			= array(18,19,20,23,24,27,28,30,32,37,42,44,47,48,49,50,51,55,56,58,60,64,70,75,80,143,144,145,156,157);
			$mobil_aktif_modul_kontrol				= array(18,19,20,23,24,27,28,30,32,37,42,44,47,48,49,50,51,55,56,58,60,64,70,75,80,143,144,145,156,157);
			$otodisi_aktif_modul_kontrol 			= array(27,18,30,28,24,51,56,19,23,20,37,32,70,143,55,47,75,58,64);			
			$arastirmaci_aktif_modul_kontrol 		= array(19,20,23,24,28,32,42,44,47,48,51,55,56,58,60,64,80);
			$uzman_aktif_modul_kontrol 				= array(27,49,24,19,23,20,50,37,32,70,55,47,75);
			$alternatif_tamir_aktif_modul_kontrol	= array(20,30,44);
			
			
			if(in_array($this->companyId,$eksper_aktif_modul_kontrol)) 			{ $modul_eksper = true; }
			if(in_array($this->companyId,$servis_aktif_modul_kontrol)) 			{ $modul_servis = true; }
			if(in_array($this->companyId,$faturali_aktif_modul_kontrol)) 		{ $modul_faturali = true; }			
			if(in_array($this->companyId,$cam_aktif_modul_kontrol)) 			{ $modul_cam = true; }			
			if(in_array($this->companyId,$tedarik_aktif_modul_kontrol)) 		{ $modul_tedarik = true; }			
			if(in_array($this->companyId,$mobil_aktif_modul_kontrol)) 			{ $modul_mobil = true; }			
			if(in_array($this->companyId,$otodisi_aktif_modul_kontrol)) 		{ $modul_otodisi = true; }
			if(in_array($this->companyId,$arastirmaci_aktif_modul_kontrol)) 	{ $modul_arastirmaci = true; }
			if(in_array($this->companyId,$uzman_aktif_modul_kontrol))			{ $modul_uzman = true; }			
			if(in_array($this->companyId,$alternatif_tamir_aktif_modul_kontrol)){ $modul_alternatif_tamir = true; }			
			
			$return_modul = array(
			'modul_eksper'=>$modul_eksper,
			'modul_servis'=>$modul_servis,			
			'modul_faturali'=>$modul_faturali,
			'modul_cam'=>$modul_cam,
			'modul_tedarik'=>$modul_tedarik,
			'modul_mobil'=>$modul_mobil,
			'modul_otodisi'=>$modul_otodisi,
			'modul_arastirmaci'=>$modul_arastirmaci,
			'modul_uzman'=>$modul_uzman,
			'modul_alternatif_tamir'=>$modul_alternatif_tamir,			
			);
			return $return_modul;
			
		}

	}	
?>